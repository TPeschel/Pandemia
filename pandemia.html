<!DOCTYPE = HTML>
<html>
	<head>
		<title>
			PANDEMIC DISEASE SIMULATIONS
		</title>
		<script src="v2.js" type="text/javascript"></script>
		<script src="rng.js" type="text/javascript"></script>
		<script src="iterasures.js" type="text/javascript"></script>
		<script src="display.js" type="text/javascript"></script>
		<script src="histogram.js" type="text/javascript"></script>
		<script src="pandemia.js" type="text/javascript"></script>
		<link rel="stylesheet" type="text/css" href="pandemia.css">
	</head>
	<body>
		<p>
		  PANDEMIC DISEASE SIMULATIONS
		</p>
		<button type="button" id="restart">
			Sim neustarten
		</button>
		<div>
			<p>Simulation</p>
	    	<canvas class = "cnvs", id="cnvs1">
				no html 5 supported
			</canvas>
		</div>
		<div>
			<div>
				<p>Keine Beschr√§nkungen</p>
				<p id="info1"></p>
			</div>
	    	<canvas class = "hist", id="histo1">
				no html 5 supported
			</canvas>
		</div>
		<script type="text/javascript">
		
			document.querySelector('#restart').addEventListener('click', restart );

			let
			colors = { 
				healthy : "#d0d0d0",
				sick : {
					treated : "#2040ff",
					untreated : "#ff4020"
				},
				recovered : {
					treated : "#80a0ff",
					untreated : "#ff9080"
				},
				dead : {
					treated : "#00007f",
					untreated : "#7f0000"
				}
			},

			walls = [ new Wall( .97, .1, 1.03, .9 ), new Wall( .47, .1, .53, .9 ), new Wall( 1.47, .1, 1.53, .9 ) ],//, new Wall( .1, .47, 1.9, .53 ) ],

			pans = [
				new Pandemia( "cnvs1", count_of_humans_x = 30, count_of_humans_y = 15, radius = .01, velocity = .004, acceleration = 1.e-7, sicktime = 250, seed = 54, addwalls = walls, colors = colors, max_hospital = .15 )
			],

			hist = [ 
				new Histogram( "histo1", 1500, pans[ 0 ].hmn.length, colors, max_hospital = .15 )
			],

			updt = [ ];

			function restart( ) {

				for( let i = 0; i < pans.length; ++ i ) {

					console.log( pans[ i ] );

					pans[ i ].restart( walls );

					hist[ i ].clear( );
				}
			}

			for( let i = 0; i < pans.length; ++ i ) {

				updt.push( 
					function( ) {

						if( ! pans[ i ].finished( ) ) {

							requestAnimationFrame ( updt[ i ] );

							pans[ i ].do( );

							if( pans[ i ].time_cnt & 0x3 == 0x3 ) {
							
								hist[ i ].add( pans[ i ].states );
							
								hist[ i ].plot( );
							}
							
							document.getElementById( "info" + ( i + 1 ) ).innerHTML = 
							"Total: " + pans[ i ].hmn.length + 
							"<br>Gesunde: " + pans[ i ].states.healthy +
							"<br>Infizierte innerhalb des Gesundheitswesens: " + pans[ i ].states.sick.treated +
							"<br>Infizierte ausserhalb des Gesundheitswesens: " + pans[ i ].states.sick.untreated +
							"<br>Geheilte innerhalb des Gesundheitswesens: " + pans[ i ].states.recovered.treated +
							"<br>Geheilte ausserhalb des Gesundheitswesens: " + pans[ i ].states.recovered.untreated +
							"<br>Tote innerhalb des Gesundheitswesens: " + pans[ i ].states.dead.treated +
							"<br>Tote ausserhalb des Gesundheitswesens: " + pans[ i ].states.dead.untreated;							
						}
					}
				)
			}

			for( let i = 0; i < pans.length; ++ i ) {

				updt[ i ]( );
			}

    	</script>
	</body>
</html>
